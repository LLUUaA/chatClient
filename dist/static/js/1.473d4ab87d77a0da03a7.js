webpackJsonp([1],{"22j4":function(t,e,o){"use strict";var a=o("2uFj"),n={name:"avatarUploadComponent",data:function(){return{uploadUrl:a.uploadUrl+"upload",uploadHeaders:{Authorization:"SessionKey "+this.$globalData.session}}},props:{avatar:null,defalutIcon:null},methods:{handleSuccess:function(t){t.fileUrl&&this.$emit("success",t.fileUrl)}}},s={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{staticClass:"file-list avatar"},[e("img",{directives:[{name:"imgLoad",rawName:"v-imgLoad",value:{src:this.avatar,errorSrc:this.defalutIcon},expression:"{src: avatar, errorSrc: defalutIcon}"}],attrs:{width:"100%",alt:"avatar"}})]),this._v(" "),e("el-upload",{staticClass:"uload-wrap",attrs:{action:this.uploadUrl,limit:1,accept:"image/*",headers:this.uploadHeaders,"on-success":this.handleSuccess,"list-type":"picture-card",enctype:"multipart/form-data"}},[e("i",{staticClass:"el-icon-plus"})])],1)},staticRenderFns:[]};var i=o("VU/8")(n,s,!1,function(t){o("enbN")},"data-v-e8143a44",null);e.a=i.exports},"7cgp":function(t,e){},ADc4:function(t,e,o){t.exports=o.p+"static/img/img-coding.8dabd62.svg"},CtDR:function(t,e){},QXW3:function(t,e,o){"use strict";var a=["😀","😁","😂","🤣","😃","😄","😅","😆","😉","😊","😋","😎","😍","😘","😗","😙","😚","🙂","🤗","🤩","🤔","🤨","😐","😑","😶","🙄","😏","🤐","😴","😜","😓","😭","😲","🤞","🖖","👌","👍","👎","✊","👊","💔"],n={name:"inputComponent",data:function(){return{inputVal:null,showEmoji:null,emojiList:a}},props:{value:[String,Number]},mounted:function(){},methods:{send:function(){this.$emit("send",encodeURIComponent(this.inputVal||""))},handleInput:function(t){this.$emit("input",t)},chooseEmoji:function(t){this.inputVal=(this.inputVal||"")+t},clear:function(){this.inputVal=""}}},s={render:function(){var t=this,e=this,o=e.$createElement,a=e._self._c||o;return a("div",{staticClass:"input-wrap flex"},[a("el-input",{attrs:{clearable:"",placeholder:"请输入内容"},on:{input:e.handleInput},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.send(t):null}},model:{value:e.inputVal,callback:function(t){e.inputVal=t},expression:"inputVal"}}),e._v(" "),a("div",{staticClass:"handle-warp flex"},[a("div",{staticClass:"icon"},[a("el-popover",{attrs:{placement:"top",title:"表情",width:"300",trigger:"click"},on:{show:function(){return t.showEmoji=!0},hide:function(){return t.showEmoji=!1}}},[a("i",{staticClass:"iconfont icon-emoji",attrs:{slot:"reference"},slot:"reference"}),e._v(" "),e._l(e.emojiList,function(t,o){return a("div",{key:o,staticClass:"emoji-item",on:{click:function(o){e.chooseEmoji(t)}}},[e._v(e._s(t))])})],2)],1),e._v(" "),a("div",{staticClass:"icon send-btn",on:{click:e.send}},[a("i",{staticClass:"iconfont icon-send"})])])],1)},staticRenderFns:[]};var i=o("VU/8")(n,s,!1,function(t){o("pHlk")},"data-v-85db6a2e",null).exports,r=o("IxXs"),c=o.n(r),l=(o("oysA"),o("8cdv"),{name:"chatComponent",components:{inputComponent:i},data:function(){return{defaultIcon:c.a}},props:{chatHistory:Array,showAvatar:Boolean,chatInfo:null},watch:{chatHistory:{handler:function(t,e){var o=this;this.$nextTick().then(function(){o.chatScorllToBottom()})},deep:!1},chatInfo:function(t,e){console.log("chatInfo",t,e)}},methods:{sendMessage:function(t){this.$emit("send",t)},handleInput:function(t){this.$emit("input",t)},clearInput:function(){this.$refs.inputRef.clear()},chatScorllToBottom:function(t){try{var e=document.querySelector("#chatWrap"),o=e.scrollHeight,a=e.scrollTop,n=null,s=Math.floor(o/10);t?n=window.requestAnimationFrame(function t(){e.scrollTop=a,o>=a?n=window.requestAnimationFrame(t):window.cancelAnimationFrame(n),a+=s}):e.scrollTop=o}catch(t){}}}}),u={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.chatInfo?a("div",{staticClass:"chat-box friend-box"},[a("div",{staticClass:"item flex"},[a("div",{staticClass:"avatar"},[a("img",{directives:[{name:"imgLoad",rawName:"v-imgLoad",value:{src:t.chatInfo.avatar||t.chatInfo.avatar,errorSrc:t.defaultIcon},expression:"{src: chatInfo.avatar || chatInfo.avatar, errorSrc: defaultIcon}"}]})]),t._v(" "),a("div",{staticClass:"right"},[a("div",{staticClass:"m-t flex"},[a("span",{staticClass:"name"},[t._v(t._s(t.chatInfo.nickName||t.chatInfo.name))])]),t._v(" "),a("div",{staticClass:"content"},[t._v(t._s(t.chatInfo.content||t.chatInfo.signature||t.chatInfo.postscript||""))])])]),t._v(" "),a("div",{staticClass:"chat-container"},[a("div",{staticClass:"chat-wrap",attrs:{id:"chatWrap"}},[t._l(t.chatHistory,function(e,o){return[a("div",{key:e.id,staticClass:"chat-item",class:e.isSender?"sender":""},[a("div",[!e.isSender&&t.showAvatar?a("div",{staticClass:"avatar room-avatar"},[e.userInfo.avatar?a("img",{attrs:{src:e.userInfo.avatar}}):t._e(),t._v(" "),a("span",[t._v(t._s(e.userInfo.surname))])]):t._e(),t._v(" "),a("div",{staticClass:"content"},[t._v(t._s(t._f("decodeContent")(e.content)))])]),t._v(" "),a("div",{staticClass:"time"},[t._v(t._s(t._f("dateTime")(e.time)))])])]}),t._v(" "),t.chatHistory&&0===t.chatHistory.length?a("div",{staticClass:"no-more"},[t._v("没有聊天内容，说点什么吧")]):t._e()],2),t._v(" "),a("inputComponent",{ref:"inputRef",on:{input:t.handleInput,send:t.sendMessage}})],1)]):a("div",{staticClass:"chat-box friend-box no-chat-wrap"},[a("img",{attrs:{src:o("ADc4")}}),t._v(" "),a("p",{staticClass:"no-more"},[t._v("点击聊天窗口进行对话")])])},staticRenderFns:[]};var d=o("VU/8")(l,u,!1,function(t){o("CtDR")},"data-v-2d316b94",null);e.a=d.exports},Yc3v:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=o("Xxa5"),n=o.n(a),s=o("exGp"),i=o.n(s),r=o("Dd8w"),c=o.n(r),l=o("mJEs"),u=o("QXW3"),d=o("22j4"),m=o("oysA"),h=o.n(m),f=o("8cdv"),p=[],v={name:"room",components:{friendsComponent:l.a,chatComponent:u.a,avatarComponent:d.a},data:function(){return{noDataText:"还没有聊天室哦，添加或创建聊天室聊天吧",roomList:null,showItem:null,chatList:null,dialogVisible:null,tabId:0,defalutIcon:h.a,ownerInfo:{},roomModal:{logo:null,name:null,roomNo:null,postscript:null},roomRules:{name:[{required:!0,message:"请输入活动名称",trigger:"blur"}],roomNo:[{required:!0,message:"请输入活动名称",trigger:"blur"},{min:6,max:12,message:"长度在 6 到 12 个字符",trigger:"blur"}],postscript:[{required:!0,message:"请输入活动名称",trigger:"blur"}]},tabList:[{id:0,text:"全部",icon:""},{id:1,text:"我的",icon:""},{id:2,text:"新建",icon:!0}]}},destroyed:function(){this.destroyedListener(p)},mounted:function(){var t=this;if(this.ownerInfo=this.$globalData.userInfo||{},this.ownerInfo.uid)this.getRoomList();else{var e=this.myListener.on(f.EVENT_GET_OWNER_INFO,function(e){t.ownerInfo=e||{},t.getRoomList()});p.push(e)}},methods:{switchTab:function(t){var e=this.ownerInfo.uid;switch(t){case 0:this.roomList=this.tempRoomList,this.tabId=t;break;case 1:this.roomList=this.tempRoomList.filter(function(t){return t.ownerUid===e}),this.tabId=t;break;case 2:this.dialogVisible=!0}},closeDialog:function(){this.$refs.roomModal.resetFields(),this.dialogVisible=!1,this.roomModal={}},handleSuccess:function(t){this.roomModal.logo=t},editRoom:function(t){this.roomModal=c()({},t),this.dialogVisible=!0},newRoom:function(){var t=this;return i()(n.a.mark(function e(){return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.$refs.roomModal.validate(function(e){if(e){t.roomModal.roomNo=Number(t.roomModal.roomNo);var o=t.roomModal.id;t.axios({url:o?"/room/update":"/room/create",method:o?"put":"post",data:t.roomModal}).then(function(e){t.dialogVisible=!1,t.getRoomList(),t.$message({showClose:!0,message:(o?"编辑":"新建")+"成功",type:"success"})},function(e){t.$message({showClose:!0,message:(o?"编辑":"新建")+"失败，请重试",type:"error"})})}});case 1:case"end":return e.stop()}},e,t)}))()},showChat:function(t){var e=this;return i()(n.a.mark(function o(){var a;return n.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(a=e.roomList[t]){o.next=3;break}return o.abrupt("return");case 3:return e.showItem=a,o.next=6,e.getChatById(a.id);case 6:e.chatList=o.sent,e.myListener.emit(f.EVENT_HAS_READ_MSG,a.notReadCount,f.ROOM),e.roomList[t].notReadCount=0;case 9:case"end":return o.stop()}},o,e)}))()},sendMessage:function(t){var e=this;this.showItem?t?this.axios({url:"message/room/send",method:"post",data:{id:this.showItem.id,content:t}}).then(function(t){e.chatList||(e.chatList=[]),e.$refs.chatRef.clearInput(),e.chatList.push(t)},function(){e.$message({showClose:!0,message:"消息发送失败，请重试",type:"error"})}):this.$message({showClose:!0,message:"请输入内容",type:"warning"}):this.$message({showClose:!0,message:"还没有选择聊天室哦",type:"warning"})},getChatById:function(t){var e=this;return i()(n.a.mark(function o(){var a;return n.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,e.axios({url:"message/history/room",params:{id:t}});case 2:return a=o.sent,o.abrupt("return",a||[]);case 4:case"end":return o.stop()}},o,e)}))()},getRoomList:function(){var t=this;this.axios({url:"room/list",method:"get"}).then(function(e){var o=t.ownerInfo.uid;(e||[]).forEach(function(t){t.showMenu=t.ownerUid===o}),t.tempRoomList=e,t.switchTab(t.tabId),t.listenMessage()})},listenMessage:function(){var t=this,e=this.myListener.on(f.EVENT_NEW_ROOM_MSG,function(e){if(t.chatList||(t.chatList=[]),t.roomList&&t.roomList.length){if(t.showItem&&e.roomId===t.showItem.id)return t.chatList.push(e),t.getChatById(e.roomId),void t.myListener.emit(f.EVENT_HAS_READ_MSG,1,f.ROOM);for(var o=0;o<t.roomList.length;o++){var a=t.roomList[o];if(a.id===e.roomId){a.notReadCount++,a.last=e,t.$set(t.roomList,o,a);break}}}});p.push(e)}}},g={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticStyle:{height:"100%"}},[o("div",{staticClass:"online-left"},[o("div",{staticClass:"banner"},[o("ul",{staticClass:"items flex"},[t._l(t.tabList,function(e){return o("li",{key:e.id,class:{current:t.tabId===e.id},on:{click:function(o){t.switchTab(e.id)}}},[e.icon?o("i",{staticClass:"el-icon-plus"}):t._e(),t._v("\n          "+t._s(e.text)+"\n        ")])}),t._v(" "),o("transition",[o("div",{staticClass:"slider",style:{left:33.3*t.tabId+"%"}})])],2),t._v(" "),o("friendsComponent",{attrs:{noDataText:t.noDataText,defalutIcon:t.defalutIcon,datas:t.roomList},on:{show:t.showChat,clickMenu:t.editRoom}})],1),t._v(" "),o("chatComponent",{ref:"chatRef",attrs:{chatHistory:t.chatList,chatInfo:t.showItem,showAvatar:!0},on:{send:t.sendMessage}})],1),t._v(" "),o("el-dialog",{attrs:{title:"创建房间",visible:t.dialogVisible,width:"700px"},on:{close:this.closeDialog}},[o("el-form",{ref:"roomModal",attrs:{model:t.roomModal,rules:t.roomRules,"label-width":"100px"}},[o("el-form-item",[o("avatarComponent",{attrs:{avatar:t.roomModal.logo,defalutIcon:t.defalutIcon},on:{success:this.handleSuccess}})],1),t._v(" "),o("el-form-item",{attrs:{label:"名称",prop:"name"}},[o("el-input",{attrs:{autocomplete:"off",maxlength:"16","show-word-limit":""},model:{value:t.roomModal.name,callback:function(e){t.$set(t.roomModal,"name",e)},expression:"roomModal.name"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"房间号",prop:"roomNo","show-word-limit":""}},[o("el-input",{attrs:{disabled:!!t.roomModal.id,type:"number",maxlength:"20",autocomplete:"off"},model:{value:t.roomModal.roomNo,callback:function(e){t.$set(t.roomModal,"roomNo",e)},expression:"roomModal.roomNo"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"描述",prop:"postscript","show-word-limit":""}},[o("el-input",{attrs:{maxlength:"100",autocomplete:"off"},model:{value:t.roomModal.postscript,callback:function(e){t.$set(t.roomModal,"postscript",e)},expression:"roomModal.postscript"}})],1)],1),t._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeDialog}},[t._v("取 消")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.newRoom}},[t._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var _=o("VU/8")(v,g,!1,function(t){o("7cgp")},"data-v-f02bb388",null);e.default=_.exports},enbN:function(t,e){},mJEs:function(t,e,o){"use strict";var a=o("IxXs"),n=o.n(a),s=(o("8cdv"),{name:"friendsComponent",data:function(){return{currentIndex:null}},props:{datas:{type:Array,default:null},toViewPath:{type:String,default:"/index/search"},defalutIcon:{type:null,default:n.a},noDataText:{type:String,default:"还没有好友哦，添加好友进行聊天吧"}},watch:{},methods:{toSearchView:function(){this.$router.push(this.toViewPath)},clickMenu:function(t){this.$emit("clickMenu",t)},showChat:function(t){this.$emit("show",t),this.currentIndex=t}}}),i={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"friend-box"},[t._l(t.datas,function(e,a){return[o("div",{key:e.uid,staticClass:"item hover flex",class:{current:a===t.currentIndex,"not-read":e.notReadCount>0},attrs:{"data-count":e.notReadCount},on:{click:function(e){t.showChat(a)}}},[o("div",{staticClass:"avatar",class:{online:e.onlineStatus,offline:0===e.onlineStatus}},[o("img",{directives:[{name:"imgLoad",rawName:"v-imgLoad",value:{src:e.avatar||e.logo,errorSrc:t.defalutIcon},expression:"{src: data.avatar || data.logo, errorSrc: defalutIcon}"}]})]),t._v(" "),o("div",{staticClass:"right"},[o("div",{staticClass:"m-t flex"},[o("span",{staticClass:"name"},[t._v(t._s(e.nickName||e.name||""))]),t._v(" "),o("span",{staticClass:"time"},[t._v(t._s(t._f("time")(e.last.time)))])]),t._v(" "),o("div",{staticClass:"content"},[t._v(t._s(t._f("decodeContent")(e.last.content)))]),t._v(" "),e.showMenu?o("i",{staticClass:"menu el-icon-more",on:{click:function(o){o.stopPropagation(),t.clickMenu(e)}}}):t._e()])])]}),t._v(" "),t.datas?0===t.datas.length?o("div",{staticClass:"no-more"},[o("span",[t._v(t._s(t.noDataText))]),t._v(" "),o("el-button",{attrs:{type:"text"},on:{click:t.toSearchView}},[t._v("去添加")])],1):t._e():o("div",{directives:[{name:"loading",rawName:"v-loading",value:!0,expression:"true"}],staticClass:"loading-wrap",attrs:{"element-loading-text":"拼命加载中","element-loading-background":"#f7fcff"}})],2)},staticRenderFns:[]};var r=o("VU/8")(s,i,!1,function(t){o("tUyB")},"data-v-03bbce8e",null);e.a=r.exports},oysA:function(t,e,o){t.exports=o.p+"static/img/icon-group-avatar.a745a61.svg"},pHlk:function(t,e){},tUyB:function(t,e){}});